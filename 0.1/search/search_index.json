{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>This is a collection of utilities to use configuration files to set parameters for a typer CLI. It is useful for typer commands with many options/arguments so you don't have to constantly rewrite long commands. This package was inspired by phha/click_config_file and prototyped in this issue. It allows you to set values for CLI parameters using a configuration file. </p> <pre><code># Long commands like this:\n$ my-typer-app --opt1 foo --opt2 bar arg1 arg2\n\n# Can become this:\n$ my-typer-app --config config.yml\n</code></pre> <p>See Examples for more.</p>"},{"location":"how/","title":"How it works","text":"<p>This works by mutating the default values in the underlying click context (<code>click.Context.default_map</code>) before the command is executed (see phha/click_config_file). It is essentially overwriting the default values that you specified in your source code. Then, the shell environment variables and CLI parameters are parsed by typer to override the values already set.</p> <p>Note: You must use <code>is_eager=True</code> in the parameter definition because that will cause it to be processed first.   If you don't use <code>is_eager</code>, then your parameter values will depend on the order in which they were processed (read: unpredictably).</p>"},{"location":"install/","title":"Installation","text":"<pre><code>$ pip install typer-config\n</code></pre> <p>Note: this only supports reading json files. See below for more file formats.</p>"},{"location":"install/#optional-dependencies","title":"Optional dependencies","text":"<p>Typer Config provides optional dependency sets to read certain file type:</p> <pre><code>$ pip install typer-config[yaml] # includes pyyaml\n\n$ pip install typer-config[toml] # includes toml\n\n$ pip install typer-config[all] # includes all optional dependencies\n</code></pre>"},{"location":"api/module/","title":"Module","text":"<p>Typer Configuration Utilities</p>"},{"location":"api/module/#typer_config.conf_callback_factory","title":"conf_callback_factory","text":"<pre><code>conf_callback_factory(\n    loader: ConfLoader,\n) -&gt; ConfigParameterCallback\n</code></pre> <p>Configuration callback factory</p>"},{"location":"api/module/#typer_config.conf_callback_factory--parameters","title":"Parameters","text":"ConfLoader <p>Config loader function that takes the value passed to the typer CLI and returns a dictionary that is applied to the click context's default map.</p>"},{"location":"api/module/#typer_config.conf_callback_factory--returns","title":"Returns","text":"<p>ConfigParameterCallback     Configuration parameter callback function.</p> Source code in <code>typer_config/__init__.py</code> <pre><code>def conf_callback_factory(loader: ConfLoader) -&gt; ConfigParameterCallback:\n\"\"\"Configuration callback factory\n\n    Parameters\n    ----------\n    loader : ConfLoader\n        Config loader function that takes the value passed to the typer CLI and\n        returns a dictionary that is applied to the click context's default map.\n\n    Returns\n    -------\n    ConfigParameterCallback\n        Configuration parameter callback function.\n    \"\"\"\n\n    def _callback(\n        ctx: Context, param: CallbackParam, param_value: TyperParameterValue\n    ) -&gt; TyperParameterValue:\n        try:\n            conf = loader(param_value)  # Load config file\n            ctx.default_map = ctx.default_map or {}  # Initialize the default map\n            ctx.default_map.update(conf)  # Merge the config Dict into default_map\n        except Exception as ex:\n            raise BadParameter(str(ex), ctx=ctx, param=param) from ex\n        return param_value\n\n    return _callback\n</code></pre>"},{"location":"api/module/#typer_config.loaders","title":"loaders","text":"<p>Configuration File Loaders.</p> These loaders must implement the interface <p>typer_config.types.ConfLoader = Callable[[Any], Dict[str, Any]]</p>"},{"location":"api/module/#typer_config.loaders.default_value_loader","title":"default_value_loader","text":"<pre><code>default_value_loader(\n    loader: ConfLoader, value_getter: NoArgCallable\n) -&gt; ConfLoader\n</code></pre> <p>Modify a loader to use a default value if the passed value is false-ish</p>"},{"location":"api/module/#typer_config.loaders.default_value_loader--parameters","title":"Parameters","text":"ConfLoader <p>loader to modify</p> NoArgCallable <p>function that returns default value</p>"},{"location":"api/module/#typer_config.loaders.default_value_loader--returns","title":"Returns","text":"<p>ConfLoader     modified loader</p> Source code in <code>typer_config/loaders.py</code> <pre><code>def default_value_loader(loader: ConfLoader, value_getter: NoArgCallable) -&gt; ConfLoader:\n\"\"\"Modify a loader to use a default value if the passed value is false-ish\n\n    Parameters\n    ----------\n    loader : ConfLoader\n        loader to modify\n    value_getter : NoArgCallable\n        function that returns default value\n\n    Returns\n    -------\n    ConfLoader\n        modified loader\n    \"\"\"\n\n    def _loader(param_value: str) -&gt; ConfDict:\n        # parameter value was not specified by user\n        if not param_value:\n            param_value = value_getter()\n\n        conf: ConfDict = loader(param_value)\n\n        return conf\n\n    return _loader\n</code></pre>"},{"location":"api/module/#typer_config.loaders.json_loader","title":"json_loader","text":"<pre><code>json_loader(param_value: TyperParameterValue) -&gt; ConfDict\n</code></pre> <p>JSON file loader</p>"},{"location":"api/module/#typer_config.loaders.json_loader--parameters","title":"Parameters","text":"TyperParameterValue <p>path of JSON file</p>"},{"location":"api/module/#typer_config.loaders.json_loader--returns","title":"Returns","text":"<p>ConfDict     dictionary loaded from file</p> Source code in <code>typer_config/loaders.py</code> <pre><code>def json_loader(param_value: TyperParameterValue) -&gt; ConfDict:\n\"\"\"JSON file loader\n\n    Parameters\n    ----------\n    param_value : TyperParameterValue\n        path of JSON file\n\n    Returns\n    -------\n    ConfDict\n        dictionary loaded from file\n    \"\"\"\n\n    with open(param_value, \"r\", encoding=\"utf-8\") as _file:\n        conf: ConfDict = json.load(_file)\n\n    return conf\n</code></pre>"},{"location":"api/module/#typer_config.loaders.subpath_loader","title":"subpath_loader","text":"<pre><code>subpath_loader(\n    loader: ConfLoader, dictpath: ConfDictAccessorPath\n) -&gt; ConfLoader\n</code></pre> <p>Modify a loader to return a subpath of the dictionary from file.</p>"},{"location":"api/module/#typer_config.loaders.subpath_loader--parameters","title":"Parameters","text":"ConfLoader <p>loader to modify</p> ConfDictPath <p>path to the section of the dictionary to return</p>"},{"location":"api/module/#typer_config.loaders.subpath_loader--returns","title":"Returns","text":"<p>ConfLoader     sub dictionary loader</p> Source code in <code>typer_config/loaders.py</code> <pre><code>def subpath_loader(loader: ConfLoader, dictpath: ConfDictAccessorPath) -&gt; ConfLoader:\n\"\"\"Modify a loader to return a subpath of the dictionary from file.\n\n    Parameters\n    ----------\n    loader : ConfLoader\n        loader to modify\n    dictpath : ConfDictPath\n        path to the section of the dictionary to return\n\n    Returns\n    -------\n    ConfLoader\n        sub dictionary loader\n    \"\"\"\n\n    def _loader(param_value: str) -&gt; ConfDict:\n        # get original ConfDict\n        conf: ConfDict = loader(param_value)\n\n        # get subpath of dictionary\n        for path in dictpath:\n            conf = conf.get(path, {})\n        return conf\n\n    return _loader\n</code></pre>"},{"location":"api/module/#typer_config.loaders.toml_loader","title":"toml_loader","text":"<pre><code>toml_loader(param_value: TyperParameterValue) -&gt; ConfDict\n</code></pre> <p>TOML file loader</p>"},{"location":"api/module/#typer_config.loaders.toml_loader--parameters","title":"Parameters","text":"TyperParameterValue <p>path of TOML file</p>"},{"location":"api/module/#typer_config.loaders.toml_loader--returns","title":"Returns","text":"<p>ConfDict     dictionary loaded from file</p> Source code in <code>typer_config/loaders.py</code> <pre><code>def toml_loader(param_value: TyperParameterValue) -&gt; ConfDict:\n\"\"\"TOML file loader\n\n    Parameters\n    ----------\n    param_value : TyperParameterValue\n        path of TOML file\n\n    Returns\n    -------\n    ConfDict\n        dictionary loaded from file\n    \"\"\"\n\n    if TOML_MISSING:  # pragma: no cover\n        raise ModuleNotFoundError(\"Please install the toml library.\")\n\n    conf: ConfDict = {}\n\n    if USING_TOMLLIB:  # pragma: no cover\n        with open(param_value, \"rb\") as _file:\n            conf = tomllib.load(_file)  # type: ignore\n    else:  # pragma: no cover\n        with open(param_value, \"r\", encoding=\"utf-8\") as _file:\n            conf = toml.load(_file)  # type: ignore\n\n    return conf\n</code></pre>"},{"location":"api/module/#typer_config.loaders.yaml_loader","title":"yaml_loader","text":"<pre><code>yaml_loader(param_value: TyperParameterValue) -&gt; ConfDict\n</code></pre> <p>YAML file loader</p>"},{"location":"api/module/#typer_config.loaders.yaml_loader--parameters","title":"Parameters","text":"TyperParameterValue <p>path of YAML file</p>"},{"location":"api/module/#typer_config.loaders.yaml_loader--returns","title":"Returns","text":"<p>ConfDict     dictionary loaded from file</p> Source code in <code>typer_config/loaders.py</code> <pre><code>def yaml_loader(param_value: TyperParameterValue) -&gt; ConfDict:\n\"\"\"YAML file loader\n\n    Parameters\n    ----------\n    param_value : TyperParameterValue\n        path of YAML file\n\n    Returns\n    -------\n    ConfDict\n        dictionary loaded from file\n    \"\"\"\n\n    if YAML_MISSING:  # pragma: no cover\n        raise ModuleNotFoundError(\"Please install the pyyaml library.\")\n\n    with open(param_value, \"r\", encoding=\"utf-8\") as _file:\n        conf: ConfDict = yaml.safe_load(_file)\n\n    return conf\n</code></pre>"},{"location":"api/types/","title":"Types","text":"<p>Data and Function types.</p>"},{"location":"api/types/#typer_config._typing.ConfDict","title":"ConfDict  <code>module-attribute</code>","text":"<pre><code>ConfDict: TypeAlias = Dict[TyperParameterName, Any]\n</code></pre> <p>Configuration dictionary to be applied to the click context default map.</p>"},{"location":"api/types/#typer_config._typing.ConfDictAccessorPath","title":"ConfDictAccessorPath  <code>module-attribute</code>","text":"<pre><code>ConfDictAccessorPath: TypeAlias = Iterable[str]\n</code></pre> <p>Configuration dictionary accessor path.</p>"},{"location":"api/types/#typer_config._typing.ConfLoader","title":"ConfLoader  <code>module-attribute</code>","text":"<pre><code>ConfLoader: TypeAlias = Callable[\n    [TyperParameterValue], ConfDict\n]\n</code></pre> <p>Configuration loader function.</p>"},{"location":"api/types/#typer_config._typing.ConfigParameterCallback","title":"ConfigParameterCallback  <code>module-attribute</code>","text":"<pre><code>ConfigParameterCallback: TypeAlias = Callable[\n    [Context, CallbackParam, TyperParameterValue],\n    TyperParameterValue,\n]\n</code></pre> <p>Typer config parameter callback function.</p>"},{"location":"api/types/#typer_config._typing.NoArgCallable","title":"NoArgCallable  <code>module-attribute</code>","text":"<pre><code>NoArgCallable: TypeAlias = Callable[[], Any]\n</code></pre> <p>No argument callable.</p>"},{"location":"api/types/#typer_config._typing.TyperParameterName","title":"TyperParameterName  <code>module-attribute</code>","text":"<pre><code>TyperParameterName: TypeAlias = str\n</code></pre> <p>Typer CLI parameter name.</p>"},{"location":"api/types/#typer_config._typing.TyperParameterValue","title":"TyperParameterValue  <code>module-attribute</code>","text":"<pre><code>TyperParameterValue: TypeAlias = Any\n</code></pre> <p>Typer CLI parameter value.</p>"},{"location":"examples/pyproject/","title":"Pyproject TOML loader","text":"<p>If you use an unsupported file format or need to do extra processing of the file, you can make your own file loader and construct an appropriate callback.</p> <p>Suppose you want to specify parameters in a section of <code>pyproject.toml</code>:</p> pyproject.toml<pre><code>[tool.my_tool.parameters]\narg1 = \"stuff\"\nopt1 = \"things\"\nopt2 = \"nothing\"\n</code></pre> <p>Then, we can read the values in our typer CLI:</p> my_tool.py<pre><code>from typing import Any, Dict\n\nimport typer\nfrom typer_config import conf_callback_factory\nfrom typer_config.loaders import toml_loader\n\n\ndef pyproject_loader(param_value: str) -&gt; Dict[str, Any]:\n    if not param_value: # set a default path to read from\n        param_value = \"pyproject.toml\"\n\n    pyproject = toml_loader(\"pyproject.toml\")\n    conf = pyproject[\"tool\"][\"my_tool\"][\"parameters\"]\n    return conf\n\n### You can define the same loader using some provided combinators:\n#\n# from typer_config.loaders import default_value_loader, subpath_loader, toml_loader\n# \n# pyproject_loader = subpath_loader(\n#     default_value_loader(toml_loader, lambda: \"pyproject.toml\"),\n#     [\"tool\", \"my_tool\", \"parameters\"],\n# )\n\npyproject_callback = conf_callback_factory(pyproject_loader)\n\napp = typer.Typer( )\n\n@app.command()\ndef main(\n    arg1: str,\n    config: str = typer.Option(\n        \"\",\n        callback=pyproject_callback,\n        is_eager=True,  # THIS IS REALLY IMPORTANT\n    ),\n    opt1: str = typer.Option(...),\n    opt2: str = typer.Option(\"hello\"),\n):\n    typer.echo(f\"{opt1} {opt2} {arg1}\")\n\n\nif __name__ == \"__main__\":\n    app()\n</code></pre> <p>And we get this behavior:</p> <pre><code>$ ls .\nmy_tool.py other.toml pyproject.toml\n\n$ python my_tool.py\nthings nothing stuff\n\n$ python my_tool.py others\nthings nothing others\n\n$ python my_tool.py --config other.toml\nsomething else entirely\n</code></pre>"},{"location":"examples/simple_yaml/","title":"Simple YAML Example","text":"<p>This simple example uses a <code>--config</code> option to load a configuration from a YAML file.</p> <p>An example typer app: simple_app.py<pre><code>import typer\nfrom typer_config import yaml_conf_callback\n\napp = typer.Typer( )\n\n@app.command()\ndef main(\n    arg1: str,\n    config: str = typer.Option(\n        \"\",\n        callback=yaml_conf_callback,\n        is_eager=True,  # THIS IS REALLY IMPORTANT\n    ),\n    opt1: str = typer.Option(...),\n    opt2: str = typer.Option(\"hello\"),\n):\n    typer.echo(f\"{opt1} {opt2} {arg1}\")\n\n\nif __name__ == \"__main__\":\n    app()\n</code></pre></p> <p>With a config file:</p> config.yaml<pre><code>arg1: stuff\nopt1: things\nopt2: nothing\n</code></pre> <p>And invoked with python:</p> <pre><code>$ python simple_app.py --config config.yml\nthings nothing stuff\n\n$ python simple_app.py --config config.yml others\nthings nothing others\n\n$ python simple_app.py --config config.yml --opt1 people\npeople nothing stuff\n</code></pre> <p>Note: this package also provides <code>json_conf_callback</code> and <code>toml_conf_callback</code> for those file formats.</p>"}]}